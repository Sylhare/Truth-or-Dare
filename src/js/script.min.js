var inputjson,gameType,stages,SOURCE="output.json",PATH="",LOCALHOST=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/src/",turn=0,idAvailable=[],index=[[],[],[],[],[],[]],turnPerStage=15,DARE={name:"Dare",id:[]},TRUTH={name:"Truth",id:[]},original={name:"original",levels:[2,3,4,5],weight:[[.4,.4,.2,0],[.35,.4,.2,.05],[.1,.25,.4,.25],[0,.1,.3,.6]],stageDare:[["At every game's stages, there will be a <i>sexy</i> special dare for all players"],["Withdraw one of your cloth"],["Keep just your undies on"],["All players must undress"]]},soft={name:"soft",levels:[2,3],weight:[[.9,.1],[.8,.2],[.7,.3],[.6,.4]],stageDare:[]},sexy={name:"sexy",levels:[3,4,5],weight:[[.7,.3,0],[.5,.4,.1],[.25,.5,.25],[.1,.3,.6]],stageDare:original.stageDare},custom={name:"custom",levels:[],weight:[],stageDare:[]};function playSound(e){var t=$("#buzzer")[0];setTimeout(function(){t.currentTime=0,t.play()},e)}function timer(e){"use strict";var t=1e3*e;$(".progress-bar").stop(),$(".progress-bar").animate({width:"0%"},100),$(".progress-bar").animate({width:"100%"},t),playSound(t)}function addStageAlert(e){gameType.stageDare[e]!==[]&&swal({title:"<div style='color:#AD4080'><span class='glyphicon glyphicon-fire'></span> Special dare!</div>",text:"<div style='color:#985E80'>"+gameType.stageDare[e]+"</div>",html:!0})}function addMoreView(){$("#settings-placeholder").toggle(),$("#input").val(turnPerStage)}function showFilesDetails(e){for(var t=[],a=0,n=e[a];a<e.length;a++)t.push("<li><strong>",escape(n.name),"</strong> (",n.type||"n/a",") - ",n.size," bytes, last modified: ",n.lastModifiedDate?n.lastModifiedDate.toLocaleDateString():"n/a","</li>");$("#list").html("<ul>"+t.join("")+"</ul>")}function clearLabel(){$("#labels").html("")}function addLabel(e,t){$("#labels").append("<span class='label label-"+e+"'>"+t+"</span></br>")}function addLevelLabel(e){var t,a;switch(e){case"0":a="disgusting",t="success";break;case"1":a="stupid",t="info";break;case"2":a="normal",t="default";break;case"3":a="soft",t="warning";break;case"4":a="sexy",t="danger";break;case"5":a="hot",t="pink";break;default:return}addLabel(t,a)}function updateLabels(e){""!==e.time&&(addLabel("default","timer"),timer(e.time)),""!==e.turns&&addLabel("default","turns"),addLevelLabel(e.level)}function updateView(e,t,a){var n=inputjson[e];clearLabel(),addLabel("primary",t),$("#type-action").text(t+": "),e>=0?(updateLabels(n),$("#text-action").text(n.summary)):$("#text-action").text("You've completed all the "+t),$("#turn").text(turn),turn-1===stages[a]&&addStageAlert(a),$("#alert-placeholder").hide()}function checkRadioBox(e,t){$("#"+e).prop("checked",t)}function setCheckBox(e,t,a){var n;for(n=e;n<=t;n++)$("#check"+n).prop("checked",a)}function indexing(e){var t,a;for(t=0;t<e.length;t++)a=e[t],index[a.level].push(t),a.type===TRUTH.name?TRUTH.id.push(t):a.type===DARE.name&&DARE.id.push(t);idAvailable=TRUTH.id.concat(DARE.id)}function setStages(){var e;stages=[];for(var t=0;t<gameType.weight.length;t++)e=t*turnPerStage,stages.push(e)}function getStage(){for(var e=0;e<stages.length-1;){if(stages[e]>=turn)return e;e++}return e}function removeID(e){var t,a=idAvailable.indexOf(e);for(a>-1&&idAvailable.splice(a,1),t=0;t<index.length;t++)if((a=index[t].indexOf(e))>-1){index[t].splice(a,1);break}}function getPossibilities(e,t){var a,n,i=[];for(a=0;a<e.length;a++){n=e[a];for(var o=0;o<t.length;o++)n===t[o]&&i.push(n)}return i}function getRandomID(e){var t=-1;return e.length>0&&removeID(t=e[Math.floor(Math.random()*e.length)]),t}function getFromIndex(e){return 2===e?index[0].concat(index[1],index[2]):index[e]}function getRandomArray(e){for(var t=gameType.weight[e],a=Math.random(),n=0,i=t.length-1,o=0;o<i;++o)if(a<(n+=t[o])){i=o;break}return getFromIndex(gameType.levels[i])}function choose(e){var t=getStage(),a=getRandomArray(t),n=getPossibilities(e.id,a);0===n.length&&(n=getPossibilities(e.id,idAvailable)),turn++,updateView(getRandomID(n),e.name,t)}function matchRadioMode(e){var t,a;switch(e){case original.name:t=0,a=5,gameType=original;break;case soft.name:t=0,a=3,gameType=soft;break;case sexy.name:t=3,a=5,gameType=sexy;break;default:return void(gameType=custom)}setStages(),setCheckBox(0,5,!1),setCheckBox(t,a,!0)}function setNewIDAvailable(){var e,t=[];for(custom.levels=[],e=0;e<=5;e++)$("#check"+e).prop("checked")&&t.push(e);for(custom.levels=t,e=0;e<t.length;e++)idAvailable.concat(index[t[e]])}function truth(){"use strict";choose(TRUTH)}function dare(){"use strict";choose(DARE)}function random(){"use strict";Math.round(Math.random())?truth():dare()}function loadJSONfromfile(e){var t=new FileReader;t.onload=function(e){try{indexing(inputjson=JSON.parse(e.target.result))}catch(e){swal("Error","Error when trying to parse json : "+e,"error")}};try{t.readAsText(e),swal("Success!","File has been successfully loaded","success")}catch(e){swal("Error",e,"error")}}function handleFileSelect(e){var t=e.target.files;showFilesDetails(t),loadJSONfromfile(t[0])}function localfileEnabling(){window.File&&window.FileReader&&window.FileList&&window.Blob?(addMoreView(),$("#files").bind("change",handleFileSelect)):swal("No Luck!","The File APIs are not fully supported in this browser.","error")}function getJSON(e){$.getJSON(e,function(e){indexing(e),inputjson=e}).fail(function(){swal("Error","The file at "+e+" couldn't be loaded. Try uploading it in settings","error"),localfileEnabling()})}function loadJSON(e){$.get(LOCALHOST+e).done(function(){getJSON(LOCALHOST+e)}).fail(function(){getJSON(PATH+e)})}$(document).ready(function(){$(".checkbox").change(function(){checkRadioBox(custom.name,!0),setNewIDAvailable()}),$(".funkyradio").find("[type='radio']").change(function(){this.checked&&matchRadioMode(this.id)}),$("input[type='number']").change(function(){turnPerStage=parseInt($("#input").val()),setStages()})}),window.onload=function(){timer(1),matchRadioMode(original.name),loadJSON(SOURCE)};